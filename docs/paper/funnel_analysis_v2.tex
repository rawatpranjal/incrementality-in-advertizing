\section*{Anaysis of Shopping Sessions}
This analysis estimates the causal effect of a user's click on a sponsored product listing on two outcomes: the probability of purchasing that product, and the log-revenue generated. The primary empirical challenge is selection bias. We employ two econometric strategies: high-dimensional fixed effects (FE) models and Double/Debiased Machine Learning (DML).

\subsubsection*{Panel Construction}

The analysis uses a panel constructed from a 365-day sample of event-level records, drawn from a 0.05\% random sample of 7,385 users. The core unit of analysis is the "macro-session," which aggregates user events into extended shopping episodes. Figure \ref{fig:session_construction} illustrates how raw event streams are transformed into analytical units.

\begin{figure}[htbp!]
\centering
\includegraphics[width=\textwidth]{session_construction.pdf}
\caption{Macro-Session Construction from Raw Event Streams. Events (auctions, impressions, clicks, purchases) are grouped into macro-sessions based on a 3-day inactivity gap. A new macro-session begins after 3 days of user inactivity, capturing extended shopping episodes that often span multiple days. Each macro-session becomes one observation unit in the analysis panel.}
\label{fig:session_construction}
\end{figure}

Macro-sessions are constructed using the following algorithm: (1) All events for a user are ordered chronologically; (2) A new macro-session is initiated when the gap between consecutive events exceeds 3 days; (3) Each unique combination of user, macro-session, and product forms one observation. This method yields a final panel of 1,786,179 observations at the user-macro-session-product level.

\begin{table}[H]
\centering
\caption{Macro-Session Summary Statistics}
\label{tab:macro_session_stats}
\begin{tabular}{lrr}
\toprule
Metric & Value & Std. Dev. \\
\midrule
\textit{Session Counts} & & \\
  \quad Total macro-sessions & 32,111 & -- \\
  \quad Unique users & 7,385 & -- \\
  \quad Sessions per user & 3.52 & 3.90 \\
\textit{Session Duration (hours)} & & \\
  \quad Mean & 52.3 & 188.6 \\
  \quad Median & 0.38 & -- \\
  \quad 95th percentile & 291.4 & -- \\
\textit{By Purchase Status} & & \\
  \quad Sessions with purchases & 4,381 (13.6\%) & -- \\
  \quad Mean duration (with purchase) & 195.8 & -- \\
  \quad Mean duration (no purchase) & 27.4 & -- \\
\textit{Session Activity} & & \\
  \quad Products per session & 68.8 & -- \\
  \quad Impressions per session & 94.8 & -- \\
  \quad Clicks per session & 3.0 & -- \\
\bottomrule
\end{tabular}
\end{table}

Table \ref{tab:descriptives} presents summary statistics for the key variables in the final panel dataset.

\begin{table}[H]
\centering
\caption{Descriptive Statistics of the Analytical Panel}
\label{tab:descriptives}
\begin{tabular}{lrr}
\toprule
Variable & Mean & Std. Dev. \\
\midrule
\textit{Outcomes} & & \\
  \quad Purchased (binary) & 0.0003 & 0.017 \\
  \quad Log(Revenue+1) & 0.0041 & 0.135 \\
\textit{Treatment} & & \\
  \quad Was Clicked (binary) & 0.0377 & 0.191 \\
\textit{Key Controls} & & \\
  \quad Log(Price+1) & 9.89 & 1.12 \\
  \quad Log(Session Duration+1) & 3.87 & 2.45 \\
  \quad Impressions on Product & 1.38 & 0.94 \\
  \quad Prior 30-Day Purchases & 0.08 & 0.49 \\
\bottomrule
\end{tabular}
\end{table}

Initial analysis of the 25,960 unique macro-sessions reveals the core behavioral dynamics. Table \ref{tab:funnel} shows the session-level conversion funnel. 37.9\% of sessions with an impression also contain a click, and 14.8\% of all sessions result in a purchase. The mean session duration is 52.3 hours, though the median is 0.38 hours, indicating a right-skewed distribution.

\begin{table}[H]
\centering
\caption{Session-Level Conversion Funnel}
\label{tab:funnel}
\begin{tabular}{lrr}
\toprule
Metric & Count & Rate \\
\midrule
Total Macro-Sessions & 25,960 & 100.0\% \\
Sessions with Impressions & 25,884 & 99.7\% \\
Sessions with Clicks & 9,830 & 37.9\% \\
Sessions with Purchases & 3,837 & 14.8\% \\
\bottomrule
\end{tabular}
\end{table}

\subsubsection*{Models}

Linear models with high-dimensional fixed effects are used to control for unobserved confounding. The specification is a Linear Probability Model (LPM) for the purchase outcome and an OLS model for the log-revenue outcome:
\[ Y_{ijst} = \theta D_{ijst} + X'_{ijst}\beta + \alpha_s + \delta_t + \epsilon_{ijst} \]
where $Y_{ijst}$ is the outcome for product $j$ in session $i$ from seller $s$ at time $t$; $D_{ijst}$ is the binary click indicator; $X'_{ijst}$ is a vector of controls; and $\alpha_s$ and $\delta_t$ are seller and time fixed effects.

To account for potential non-linearities, we also use a DML model based on the partially linear specification $Y = \theta D + g(X) + \epsilon$. The nuisance functions $g(X) = E[Y|X]$ and $m(X) = E[D|X]$ are estimated using LightGBM with 5-fold cross-fitting. First, residuals are estimated on separate folds:
\[ \tilde{Y}_i = Y_i - \hat{g}_0(X_i) \quad \text{and} \quad \tilde{D}_i = D_i - \hat{m}_0(X_i) \]
In the second stage, $\theta$ is estimated via OLS on the residuals: $\tilde{Y} = \theta \tilde{D} + \text{error}$. The treatment prediction model ($\hat{m}_0$) achieves an AUC of 0.716, while the outcome model ($\hat{g}_0$) has an R-squared near zero.

The variables used in the analysis are defined in Table \ref{tab:variable_definitions}.

\begin{table}[H]
\centering
\caption{Variable Definitions}
\label{tab:variable_definitions}
\begin{tabular}{p{4cm}p{2cm}p{7cm}}
\toprule
Variable Name & Type & Description \\
\midrule
\textit{Outcome Variables} & & \\
\quad \texttt{purchased} & Binary & 1 if the product was purchased in the macro-session, 0 otherwise. \\
\quad \texttt{log\_revenue} & Continuous & Natural log of (revenue in USD + 1). \\
\textit{Treatment Variable} & & \\
\quad \texttt{treated} & Binary & 1 if the product received at least one click in the macro-session, 0 otherwise. \\
\textit{Control Variables} & & \\
\quad \texttt{log\_price} & Continuous & Natural log of (product price in USD + 1). \\
\quad \texttt{impressions\_on\_product} & Continuous & Total number of impressions on the product within the macro-session. \\
\quad \texttt{duration\_winsorized} & Continuous & The duration of the macro-session in hours, winsorized at the 99th percentile. \\
\quad \texttt{distinct\_products} & Continuous & Count of distinct products viewed in the macro-session. \\
\quad \texttt{prior\_30d\_purchases} & Integer & Count of user's purchases in the 30 days prior to the macro-session. \\
\bottomrule
\end{tabular}
\end{table}

\subsubsection*{Results}

Table \ref{tab:main_results} presents the Average Treatment Effect (ATE) of a click across model specifications. For the purchase outcome (Panel A), the Panel FE LPM estimates an ATE of 0.0074 (SE 0.0002). In contrast, the DML model estimates an ATE of 0.1673 (SE 0.0017), an effect more than 20 times larger. For the log-revenue outcome (Panel B), all models produce estimates in a stable range. The HDFE model, which absorbs the full set of vendor and week fixed effects, estimates an ATE of 0.0576 (SE 0.0026), while the DML model provides a comparable estimate of 0.0405 (SE 0.0005).

\begin{table}[H]
\centering
\caption{The Average Treatment Effect of a Click Across Specifications}
\label{tab:main_results}
\resizebox{\textwidth}{!}{
\begin{tabular}{lcccc}
\toprule
 & \multicolumn{2}{c}{(1) Outcome: Purchase (ATE)} & \multicolumn{2}{c}{(2) Outcome: Log(Revenue+1) (ATE)} \\
\cmidrule(lr){2-3} \cmidrule(lr){4-5}
Specification & Coefficient & Std. Error & Coefficient & Std. Error \\
\midrule
\textit{Panel A: Linear Models} & & & & \\
  \quad Baseline (LPM/OLS) & 0.0074*** & (0.0001) & 0.0575*** & (0.0006) \\
  \quad + Vendor \& Week FE & 0.0074*** & (0.0002) & 0.0575*** & (0.0013) \\
  \quad + High-Dimensional FE (120K vendors) & -- & -- & 0.0576*** & (0.0026) \\
\midrule
\textit{Panel B: Session-Level Aggregation} & & & & \\
  \quad Session LPM & 0.0145*** & (0.0016) & 0.1119*** & (0.0126) \\
  \quad Session Panel FE & 0.0147*** & (0.0005) & 0.1137*** & (0.0041) \\
\midrule
\textit{Panel C: Double Machine Learning} & & & & \\
  \quad DML without CRE & 0.0073*** & (0.0002) & 0.0405*** & (0.0005) \\
  \quad DML with CRE\footnote{Correlated Random Effects (CRE) is a panel data method that bridges fixed and random effects models by including panel means of time-varying regressors as controls. This approach, developed by Mundlak (1978) and Chamberlain (1982), allows estimation of both time-varying and time-invariant effects while controlling for correlation between regressors and unobserved confounding. CRE provides FE-equivalent estimates for time-varying regressors while retaining the ability to estimate effects of time-invariant variables.} & 0.0072*** & (0.0002) & 0.0400*** & (0.0005) \\
\bottomrule
\end{tabular}%
}
\end{table}

Table \ref{tab:robustness} presents results from alternative specifications. The DML estimate for purchase is robust to the inclusion of Correlated Random Effects (CRE) features, which reduces the estimate slightly from 0.1673 to 0.1513 (Panel A). A regularized logistic regression, which is less prone to failure with rare events, produces an odds ratio of 2.72, confirming a positive and significant effect (Panel B). Heterogeneous effects analysis indicates the ATE on purchase is larger for lower-priced goods and in sessions with high purchase intent (Panel C).

\begin{table}[H]
\centering
\caption{Robustness and Heterogeneity of the Treatment Effect}
\label{tab:robustness}
\begin{tabular}{llr}
\toprule
Specification & Metric & Value \\
\midrule
\textit{Panel A: Alternative Specifications} & & \\
  \quad Regularized Logit & Odds Ratio & 2.72*** \\
  \quad Session-Level LPM (N=26K) & ATE (Purchase) & 0.0147*** \\
  \quad Product-Level LPM (N=1.8M) & ATE (Purchase) & 0.0074*** \\
\midrule
\textit{Panel B: Model Performance} & & \\
  \quad DML Treatment Prediction & AUC & 0.716 \\
  \quad Fixed Effects Models & RÂ² (within) & 0.007 \\
\midrule
\textit{Panel C: Effect Magnitudes} & & \\
  \quad Purchase effect (percentage points) & Range across models & 0.7--1.5 pp \\
  \quad Log Revenue effect & Range across models & 4.0--5.8\% \\
  \quad Relative increase in purchase rate & Over 0.03\% base & 240--490\% \\
\bottomrule
\end{tabular}
\end{table}

\subsubsection*{Conclusion}
The analysis yields two primary empirical findings. First, the causal effect of a click on log-revenue is consistently estimated in the range of +4.1\% to +5.8\% across both linear and non-linear model specifications. Second, the estimated effect on purchase probability is sensitive to model specification. Our preferred specification is the DML model, given its flexibility and the demonstrated predictive power of its treatment assignment model. This model yields a final ATE on purchase probability of +16.7 percentage points and an ATE on log-revenue of +4.1\%.

